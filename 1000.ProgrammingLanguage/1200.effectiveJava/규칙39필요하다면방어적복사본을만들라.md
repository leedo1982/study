

#규칙39 필요하다면 방어적 복사본을 만들라.

자바를 사용하기가 편한것은, 안전한 언어이기 때문이다.
안전한 언어를 쓴다해도, 스스로 노력하지 않으면 다른 클래스의 영향으로부터 완전히 자유로울 수는 없다.
따라서 만드는 클래스의 클라이언트가 불변식을 망가뜨리기 위해 최선을 다할 것이라는 가정하에, 방어적
프로그래밍을 해야한다. 

객체의 내부를 보호하려면 생성자로 전달되는 변경가는 객체를 반드시 방어적으로 복사해서 그 복사본을
Period 객체의 컴포넌트로 이용해야한다.

인자의 유효성을 검사하기 전에 방어적 복사본을 만들고, 그 복사본으로 요효성 검사를 실시한다.

인자로 전달된 객체의 자료형이 제3자가 계승할 수 있는 자료형일 경우, 방어적 복사본을 만들 때
clone을 사용하지 않도록 해야한다. 또한 변경가능 내부필드에 대한 방어적 복사본을 반환하도록
접근자를 수정해야 한다. 

논쟁의 소지가 있지만 여기서 배워야할 진짜 교훈은, 객체의 컴포넌트로는 가능하다면 변경 불가능 객체를
사용해야 한다. 그래야 방어적 복사본에 대해서는 신경 쓸 필요가 없어지기 때문이다.

요약하자면, 클라이언트로부터 구했거나 클라이언트에게 반환되는 변경가능 컴포넌트가 있는 경우, 
해당 클래스는 그 컴포넌트를 반드시 방어적으로 복사해야한다. 복사 오버헤드가 너무 크고 클래스 사용자가
그 내부 컴포넌트를 부적적하게 변경하지 않는다는 보장이 있을 때는, 방어적 복사를 하는 대신
클라이언트 측에서 해당 컴포넌트를 변경해서는 안된다는 사실만 문서에 명시하고 넘어갈 수도 있다.

 


