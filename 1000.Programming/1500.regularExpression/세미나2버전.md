

3.프로그래머를 위한 고급 정규표현식
- 단순한 정규표현식과 최신 엔진의 구조 비교

3.1 단순한 정규표현식과 정규언어
여기서 정규표현식과 '일치하는 문자열 집합'에 주목한다.
이것은 정규언어라 불리는 것으로 '집합'이 무엇인지 설명한다.

|집합의 기준
예를 들어, a*b*의 졍규표현식에 일치하는 문자열은
공백 문자열 부터 무한히 존재....

a*b*라는 정규표현식에 일치하는 문자열 지밥이란 위에 열거한 문자열집합
전부를 모은것이다.

'정규표현식'과 '정규표현식에 일치하는 문자열 집합 = 정규언어'는 떼려야 뗄수 없는 관계이다.

|문자 집합
집합이란 '무엇인가를 모아놓은것'
전세계의 문자를 처리할 수 있는 표준규격인 유니코드에는 113,021개의 문자가 등록되어 있다.

|문자열 집합
문자집합의 문자를 조합하여 만들수 있는 모든 문자열 집합.

예를 들어,
문자 집합 = {0,1}
문자열 집합 = {0,1,01,00,10,11,000,.....}

또한, 문자열 집합은 공백 문자열을 포함한다.(공백문자 = 길이가 0인 문자열= 입실론)
     문자열 집합은 무한집합이다

|집합의 작성법 : 외연적 기법과 내포적 기법
외연적 기법 {0,1,2,3,4,5,6,7,8,9}
내포적 기법 {n | n는 0이상 10미만의 자연수}

|언어 = 문자열 집합
형식언어 이론에서는 문자집합 삽의 언어란 문자열 집합의 부분 집합을 가리킨다.
형식언어 이론이란?자연 언어(일상생활에서 사용하는 언어)와 구별되는 언어의 형식 여러 가지 특성을 이론적으로 조사하는 학문.

|단순한 정규표현식
- 공집합과 공백 문자열을 나타내는 정규표현식
공집합을 공백 문자열로 하는 정규표현식은 '어떤 문자열도 일치하지 않는' 특인한 형태의 정규표현식으로 현재의 프로그래머용 정규표현식에서는 공집합 기호를 사용하지 않는다.

|정규표현식으로 표현할 수 있는 언어.
모든 정규언어는 반드시 그것을 표현하는 정규현식이 존재하므로, 정규표현식은 정규 언어를 표현하기 위한 하나의 정규방법이라 할 수 있다.

3.2 현대 정규표현식의 다양한 기능/구문/구현
접합/선택/반복 기본 3연산
현대 정규표현식은 문자 클래스나 수량자, 전방탐색, 재귀, 역참조 등 다양한 기능/구문이 추가되었다.

|정규표현식의 기능 추가 흐름과 다양한 엔진이 존재하는 이유
현재 전세계에는 많은 정규표현식 엔진이 존재한다.
grep이나 sed 처럼 커맨드라인 툴 내부
대부분의 스크립트언어(펄, 루비, 파이썬, 자바스크립트)도 자체 정규식 엔진을 내장하고 있다.
또한 Google RE2나 PCRE 등 정규표현식 단독으로 출시되 있는 프로젝트도 있다.
왜? 이렇게 많은가?
여기서 나열한 정규표현식 엔진들은 각기 다른 목적이기 때문이다.
프로그래밍 언어와의 친화성이나 확장성을 목적으로 한것(스크립트언어 내장 엔진 전반)도 있고
다기능성을 목적으로 한것(펄, PCRE)
속도나 메모리 효율성을 중요시한것(gerp, RE2)
스레트 안정성(RE2) 추구한 것도 있다.

|정규표현식 엔진간 기능/구문 차이

차이이해의 목적은 대부분의 엔진에서 공통적으로 사용할 수 있는 기능/구문과 동작을 파악해 두는 것에 있다.
이런 이유로 정규표현식 엔진이 어떤 구조로 동작하는지 파악하는 일이 중요하다.
엔젠인 크게 VM 형 엔진과 DFA형 엔진으로 구분되며
간랸하게 말해 기능 중심의 VM형, 속도 중심의 DFA형이 있다.

|기존 엔진의 벤치마크크
-정규표현식 라이브러리
RE2, PCRE, 오니구루마, TRE 에 대하여 벤치마크
대략적으로 PCRE와 오니구루마 => VM
TRE, RE2 => DFA
RE2는 C++ , 나머지는 C언어

3.3 읽기 쉬운 정규표현식 작성
|간단히 작성하기

'짧은' 정규표현식은 가독성의 척도라고 할 수 있다.
짧게 작성하는 비법
- 그룹화나 수량자, 문자 클래스, 이스케이프 활용
ex. 02-[0-9][0-9][0-9][0-9][0-9]-[0-9][0-9][0-9][0-9][0-9]
 ==> 02(-\d{4}){2}
- 전방 탐색이나 후방 탐색등의 확장기능 활용
.*hoge.*fuga.*piyo.*| .*hoge.*piyo.*fuga.*| .*fuga.*hoge.*piyo.*| .*fuga.*piyo.*hoge.*| .*piyo.*hoge.*fuga.*| .*piyo.*fuga.*hoge.*

==> 전방탐색
(?=.*hoge.*)(?=.*fuga.*)(?=.*piyo.*)

위의 예제
- 정규표현식의 부품화

| 설명형식으로 적기
길게 작성하더라도 설명 형식으로 작성하여 읽기 쉬워지게 작성

ex. (\d{2})\/(\d{2})\/(\d{4})
ex. (?<day>\d{2})\/(?<month>\d{2})\/(?<year>\d{4})

짧고 간단하게 작성하기와 길게 설명 형식으로 작성하기는 얼핏 상반된 접근법이지만
적절히 취사 선택하거나 조합 하여 사용하는 것이 좋다.

3.4 현실적으로 타협하기
|엄격한 정규표현식

-메일 주소의 정규표현식(html5 input mail patten)
^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$

하지만 HTML5의 공식 문서에 따르면 이 정규표현식은 실용성을 위해 의도적으로 RFC 정의 표준문법을 따르고 있지 않다고 강조하고 있다.
최신 사양이라고 할 수 있는 HTML5가 제공하는 메일 주소이므로 이렇게 절충형 정규표현식을 사용한다는 것이 숙명일 수도 있다.

- 전화번호의 정규표현식
서울의 유선 전화번호를 표현하는 식
02(-\d{4}){2}

완벽하게 표현 안됨 02-0000-0000
그러나 모든 전화번호를 확인해서 엄격하게 할수 있으나 수고를 생각하면 현실적이지 못하다.

-URI / URL 정규표현식

|절충형 정규표현식
절출형 정규표현식을 작성할 때 중요한 사항은 둘중 어느 것을 중시하느냐다.
1. 맞는 문자열ㅇ 일치한다.
2. 맞지 않은 문자열에는 일치하지 안한다.

1, 2 가 모둔 만족하면 완벽한 정규표현식
 절충형 정규표현식은 둘중 하나로 좁힌후 다음사항을 인정
 (1) 맞는 문자열이 일치하지 않는다.(false negative)
 (2) 맞는 않는 문자열이 일치한다.(false positive)


 -URL 정규표현식
RFC 3986에서는 URL을 표현히기 위한 절충형 정규표현식으로 다음을 소개하고 있다.

 (([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?
 12            3  4          5       6  7        8 9

 http://www.ics.uci.edu/pub/ietf/uri/#Related

1 http:
2 http
3 //www.ics.uci.edu
4 www.ics.uci.edu
5 /pub/ietf/uri
6 <undefined>
7 <undefined>
8 #Related
9 Related
